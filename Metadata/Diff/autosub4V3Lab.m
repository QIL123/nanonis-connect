% code to analyze the images of Co3Sn2S2 sample (for imsubV3)
clear all
close all

BatchN=44;



if BatchN<10
    BatchN=['0',num2str(BatchN)];
else
    BatchN=num2str(BatchN)
end
Batch=['Batch',BatchN];

% Folder_Data =['/Users/avianoah/Google Drive/University/Research/AHE/Data/Tip20200426/',Batch];
Folder_Data=['C:\Users\Owner\Google Drive\4K microscope\data\AHE\Data\Tip20200426\',Batch];
Dir=[Folder_Data,'/Output_BW/Matrices'];

%establish the list of files
file_list = dir(Dir)
[N_file,~]=size(file_list);

% Read Info
Info_File=fullfile(Folder_Data,['Batch_',BatchN,'.dat']);
Info_C=readcell(Info_File);
Info_Index={'Name','Batch_Num','Z_Encoder','Z_Scan','Field_Sweep','Field_Measured','Vbias' ...
    ,'Response','Time','Pixels','Lines','Xrange','Yrange','Xcenter','Ycenter','Angle','Delta'...
    ,'Average','STD'};
Info = cell2table(Info_C(2:end,:),'VariableNames',Info_Index);  % Info as table

Save_Loc=fullfile(fileparts(Dir),'Diff');
if ~ exist(Save_Loc,'dir')
    mkdir(Save_Loc)
end

%setting the figure
newfig=figure();
clf
set(newfig,'Units','pixel')
set(newfig,'Position',[10 100 1000 350],'Color',[1 1 1])
fontcolor=[1 1 1];
Title_Color=[0 0 0];
linewidth=1;
fontsize=10;

taille=300;
posfig1=[30 10 taille taille];
posfig2=[30+taille+30 10 taille taille];
posfig3=[30+(taille+30)*2 10 taille taille];

%setting the axes
fig1=axes('Parent',newfig,'ZColor',fontcolor,'YColor',fontcolor,...
        'XColor',fontcolor,...
        'LineWidth',linewidth,...
        'FontSize',fontsize,...   
        'Color','none',...
        'Units','Pixel',...
        'xticklabel',{''},...
        'yticklabel',{''},...
        'xtick',[],...
        'ytick',[],...
        'Position',posfig1);
box(fig1,'off');    
hold(fig1,'off');


fig2=axes('Parent',newfig,'ZColor',fontcolor,'YColor',fontcolor,...
        'XColor',fontcolor,...
        'LineWidth',linewidth,...
        'FontSize',fontsize,...   
        'Color','none',...
        'Units','Pixel',...
        'xticklabel',{''},...
        'yticklabel',{''},...
        'xtick',[],...
        'ytick',[],...
        'Position',posfig2);
box(fig2,'off');    
hold(fig2,'off');


fig3=axes('Parent',newfig,'ZColor',fontcolor,'YColor',fontcolor,...
        'XColor',fontcolor,...
        'LineWidth',linewidth,...
        'FontSize',fontsize,...   
        'Color','none',...
        'Units','Pixel',...
        'xticklabel',{''},...
        'yticklabel',{''},...
        'xtick',[],...
        'ytick',[],...
        'Position',posfig3);
box(fig3,'off');    
hold(fig3,'off');


% Get gold
r=[0.988235294117647;0.988235294117647;0.988235294117647;0.984313725490196;0.984313725490196;0.984313725490196;0.980392156862745;0.980392156862745;0.976470588235294;0.976470588235294;0.976470588235294;0.972549019607843;0.972549019607843;0.972549019607843;0.968627450980392;0.968627450980392;0.964705882352941;0.964705882352941;0.964705882352941;0.960784313725490;0.960784313725490;0.960784313725490;0.956862745098039;0.956862745098039;0.952941176470588;0.952941176470588;0.952941176470588;0.949019607843137;0.949019607843137;0.949019607843137;0.945098039215686;0.945098039215686;0.941176470588235;0.941176470588235;0.941176470588235;0.937254901960784;0.937254901960784;0.937254901960784;0.933333333333333;0.933333333333333;0.929411764705882;0.929411764705882;0.929411764705882;0.925490196078431;0.925490196078431;0.925490196078431;0.921568627450980;0.921568627450980;0.917647058823529;0.917647058823529;0.917647058823529;0.913725490196078;0.913725490196078;0.913725490196078;0.909803921568627;0.909803921568627;0.905882352941177;0.905882352941177;0.905882352941177;0.901960784313726;0.901960784313726;0.901960784313726;0.898039215686275;0.898039215686275;0.894117647058824;0.894117647058824;0.894117647058824;0.890196078431373;0.890196078431373;0.886274509803922;0.886274509803922;0.886274509803922;0.882352941176471;0.882352941176471;0.882352941176471;0.878431372549020;0.878431372549020;0.874509803921569;0.874509803921569;0.874509803921569;0.870588235294118;0.870588235294118;0.870588235294118;0.866666666666667;0.866666666666667;0.862745098039216;0.862745098039216;0.862745098039216;0.858823529411765;0.858823529411765;0.858823529411765;0.854901960784314;0.854901960784314;0.850980392156863;0.850980392156863;0.850980392156863;0.847058823529412;0.847058823529412;0.847058823529412;0.843137254901961;0.843137254901961;0.839215686274510;0.839215686274510;0.839215686274510;0.835294117647059;0.835294117647059;0.835294117647059;0.831372549019608;0.831372549019608;0.827450980392157;0.827450980392157;0.827450980392157;0.823529411764706;0.823529411764706;0.823529411764706;0.819607843137255;0.819607843137255;0.815686274509804;0.815686274509804;0.815686274509804;0.811764705882353;0.811764705882353;0.811764705882353;0.807843137254902;0.807843137254902;0.803921568627451;0.803921568627451;0.803921568627451;0.800000000000000;0.800000000000000;0.796078431372549;0.796078431372549;0.796078431372549;0.792156862745098;0.792156862745098;0.792156862745098;0.788235294117647;0.788235294117647;0.784313725490196;0.784313725490196;0.784313725490196;0.780392156862745;0.780392156862745;0.780392156862745;0.776470588235294;0.776470588235294;0.772549019607843;0.772549019607843;0.772549019607843;0.768627450980392;0.768627450980392;0.768627450980392;0.764705882352941;0.764705882352941;0.760784313725490;0.760784313725490;0.760784313725490;0.756862745098039;0.756862745098039;0.756862745098039;0.752941176470588;0.752941176470588;0.749019607843137;0.749019607843137;0.749019607843137;0.745098039215686;0.745098039215686;0.745098039215686;0.741176470588235;0.741176470588235;0.737254901960784;0.737254901960784;0.733333333333333;0.733333333333333;0.729411764705882;0.729411764705882;0.725490196078431;0.721568627450980;0.721568627450980;0.717647058823529;0.717647058823529;0.713725490196078;0.709803921568628;0.709803921568628;0.705882352941177;0.705882352941177;0.701960784313725;0.701960784313725;0.698039215686275;0.694117647058824;0.694117647058824;0.690196078431373;0.690196078431373;0.686274509803922;0.682352941176471;0.682352941176471;0.678431372549020;0.678431372549020;0.674509803921569;0.670588235294118;0.670588235294118;0.666666666666667;0.666666666666667;0.662745098039216;0.662745098039216;0.658823529411765;0.654901960784314;0.654901960784314;0.650980392156863;0.650980392156863;0.647058823529412;0.643137254901961;0.643137254901961;0.639215686274510;0.639215686274510;0.635294117647059;0.631372549019608;0.631372549019608;0.627450980392157;0.627450980392157;0.623529411764706;0.623529411764706;0.619607843137255;0.615686274509804;0.615686274509804;0.611764705882353;0.611764705882353;0.607843137254902;0.603921568627451;0.603921568627451;0.600000000000000;0.600000000000000;0.596078431372549;0.592156862745098;0.592156862745098;0.588235294117647;0.588235294117647;0.584313725490196;0.580392156862745;0.580392156862745;0.576470588235294;0.576470588235294;0.572549019607843;0.572549019607843;0.568627450980392;0.564705882352941;0.564705882352941;0.560784313725490;0.560784313725490;0.556862745098039;0.552941176470588;0.552941176470588;0.549019607843137;0.549019607843137;0.545098039215686;0.541176470588235;0.541176470588235;0.537254901960784;0.537254901960784;0.533333333333333;0.533333333333333;0.529411764705882;0.525490196078431;0.525490196078431;0.521568627450980;0.521568627450980;0.517647058823530;0.513725490196078;0.513725490196078;0.509803921568627;0.509803921568627;0.505882352941176;0.501960784313726;0.501960784313726;0.498039215686275;0.498039215686275;0.494117647058824;0.494117647058824;0.490196078431373;0.486274509803922;0.486274509803922;0.482352941176471;0.482352941176471;0.478431372549020;0.474509803921569;0.474509803921569;0.470588235294118;0.470588235294118;0.466666666666667;0.462745098039216;0.462745098039216;0.458823529411765;0.458823529411765;0.454901960784314;0.454901960784314;0.450980392156863;0.447058823529412;0.447058823529412;0.443137254901961;0.443137254901961;0.439215686274510;0.435294117647059;0.435294117647059;0.431372549019608;0.431372549019608;0.427450980392157;0.423529411764706;0.423529411764706;0.419607843137255;0.419607843137255;0.415686274509804;0.415686274509804;0.411764705882353;0.407843137254902;0.407843137254902;0.403921568627451;0.403921568627451;0.400000000000000;0.396078431372549;0.396078431372549;0.392156862745098;0.392156862745098;0.388235294117647;0.384313725490196;0.384313725490196;0.380392156862745;0.380392156862745;0.376470588235294;0.372549019607843;0.372549019607843;0.368627450980392;0.368627450980392;0.364705882352941;0.364705882352941;0.360784313725490;0.356862745098039;0.356862745098039;0.352941176470588;0.352941176470588;0.349019607843137;0.345098039215686;0.345098039215686;0.341176470588235;0.341176470588235;0.337254901960784;0.337254901960784;0.333333333333333;0.333333333333333;0.329411764705882;0.329411764705882;0.325490196078431;0.325490196078431;0.321568627450980;0.321568627450980;0.317647058823529;0.317647058823529;0.313725490196078;0.313725490196078;0.309803921568627;0.309803921568627;0.305882352941177;0.301960784313725;0.301960784313725;0.298039215686275;0.298039215686275;0.294117647058824;0.294117647058824;0.290196078431373;0.290196078431373;0.286274509803922;0.286274509803922;0.282352941176471;0.282352941176471;0.278431372549020;0.278431372549020;0.274509803921569;0.274509803921569;0.270588235294118;0.270588235294118;0.266666666666667;0.266666666666667;0.262745098039216;0.262745098039216;0.258823529411765;0.258823529411765;0.254901960784314;0.254901960784314;0.250980392156863;0.247058823529412;0.247058823529412;0.243137254901961;0.243137254901961;0.239215686274510;0.239215686274510;0.235294117647059;0.235294117647059;0.231372549019608;0.231372549019608;0.227450980392157;0.227450980392157;0.223529411764706;0.223529411764706;0.219607843137255;0.219607843137255;0.215686274509804;0.215686274509804;0.211764705882353;0.211764705882353;0.207843137254902;0.207843137254902;0.203921568627451;0.203921568627451;0.200000000000000;0.200000000000000;0.196078431372549;0.196078431372549;0.192156862745098;0.188235294117647;0.188235294117647;0.184313725490196;0.184313725490196;0.180392156862745;0.180392156862745;0.176470588235294;0.176470588235294;0.172549019607843;0.172549019607843;0.168627450980392;0.168627450980392;0.164705882352941;0.164705882352941;0.160784313725490;0.160784313725490;0.156862745098039;0.156862745098039;0.152941176470588;0.152941176470588;0.149019607843137;0.149019607843137;0.145098039215686;0.145098039215686;0.141176470588235;0.141176470588235;0.137254901960784;0.133333333333333;0.133333333333333;0.129411764705882;0.129411764705882;0.125490196078431;0.125490196078431;0.121568627450980;0.121568627450980;0.117647058823529;0.117647058823529;0.113725490196078;0.113725490196078;0.109803921568627;0.109803921568627;0.105882352941176;0.105882352941176;0.101960784313725;0.101960784313725;0.0980392156862745;0.0980392156862745;0.0941176470588235;0.0941176470588235;0.0901960784313726;0.0901960784313726;0.0862745098039216;0.0862745098039216;0.0823529411764706;0.0784313725490196;0.0784313725490196;0.0745098039215686;0.0745098039215686;0.0705882352941177;0.0705882352941177;0.0666666666666667;0.0666666666666667;0.0627450980392157;0.0627450980392157;0.0588235294117647;0.0588235294117647;0.0549019607843137;0.0549019607843137;0.0509803921568627;0.0509803921568627;0.0470588235294118;0.0470588235294118;0.0431372549019608;0.0431372549019608;0.0392156862745098;0.0392156862745098;0.0352941176470588;0.0352941176470588;0.0313725490196078;0.0313725490196078;0.0274509803921569;0.0235294117647059;0.0235294117647059;0.0196078431372549;0.0196078431372549;0.0156862745098039;0.0156862745098039;0.0117647058823529;0.0117647058823529;0.00784313725490196;0.00784313725490196;0.00392156862745098;0.00392156862745098;0;0;0];
g=[0.988235294117647;0.988235294117647;0.984313725490196;0.980392156862745;0.980392156862745;0.976470588235294;0.972549019607843;0.968627450980392;0.968627450980392;0.964705882352941;0.960784313725490;0.956862745098039;0.956862745098039;0.952941176470588;0.949019607843137;0.949019607843137;0.945098039215686;0.941176470588235;0.937254901960784;0.937254901960784;0.933333333333333;0.929411764705882;0.925490196078431;0.925490196078431;0.921568627450980;0.917647058823529;0.917647058823529;0.913725490196078;0.909803921568627;0.905882352941177;0.905882352941177;0.901960784313726;0.898039215686275;0.894117647058824;0.894117647058824;0.890196078431373;0.886274509803922;0.882352941176471;0.882352941176471;0.878431372549020;0.874509803921569;0.874509803921569;0.870588235294118;0.866666666666667;0.862745098039216;0.862745098039216;0.858823529411765;0.854901960784314;0.850980392156863;0.850980392156863;0.847058823529412;0.843137254901961;0.843137254901961;0.839215686274510;0.835294117647059;0.831372549019608;0.831372549019608;0.827450980392157;0.823529411764706;0.819607843137255;0.819607843137255;0.815686274509804;0.811764705882353;0.807843137254902;0.807843137254902;0.803921568627451;0.800000000000000;0.800000000000000;0.796078431372549;0.792156862745098;0.788235294117647;0.788235294117647;0.784313725490196;0.780392156862745;0.776470588235294;0.776470588235294;0.772549019607843;0.768627450980392;0.768627450980392;0.764705882352941;0.760784313725490;0.756862745098039;0.756862745098039;0.752941176470588;0.749019607843137;0.745098039215686;0.745098039215686;0.741176470588235;0.737254901960784;0.737254901960784;0.733333333333333;0.729411764705882;0.725490196078431;0.725490196078431;0.721568627450980;0.717647058823529;0.713725490196078;0.713725490196078;0.709803921568628;0.705882352941177;0.701960784313725;0.701960784313725;0.698039215686275;0.694117647058824;0.694117647058824;0.690196078431373;0.686274509803922;0.682352941176471;0.682352941176471;0.678431372549020;0.674509803921569;0.670588235294118;0.670588235294118;0.666666666666667;0.662745098039216;0.662745098039216;0.658823529411765;0.654901960784314;0.650980392156863;0.650980392156863;0.647058823529412;0.643137254901961;0.639215686274510;0.639215686274510;0.635294117647059;0.631372549019608;0.627450980392157;0.627450980392157;0.623529411764706;0.619607843137255;0.619607843137255;0.615686274509804;0.611764705882353;0.607843137254902;0.607843137254902;0.603921568627451;0.600000000000000;0.596078431372549;0.596078431372549;0.592156862745098;0.588235294117647;0.588235294117647;0.584313725490196;0.580392156862745;0.576470588235294;0.576470588235294;0.572549019607843;0.568627450980392;0.564705882352941;0.564705882352941;0.560784313725490;0.556862745098039;0.556862745098039;0.552941176470588;0.549019607843137;0.545098039215686;0.545098039215686;0.541176470588235;0.537254901960784;0.533333333333333;0.533333333333333;0.529411764705882;0.525490196078431;0.521568627450980;0.521568627450980;0.517647058823530;0.513725490196078;0.513725490196078;0.509803921568627;0.505882352941176;0.501960784313726;0.501960784313726;0.498039215686275;0.498039215686275;0.494117647058824;0.490196078431373;0.490196078431373;0.486274509803922;0.486274509803922;0.482352941176471;0.478431372549020;0.478431372549020;0.474509803921569;0.474509803921569;0.470588235294118;0.466666666666667;0.466666666666667;0.462745098039216;0.462745098039216;0.458823529411765;0.458823529411765;0.454901960784314;0.450980392156863;0.450980392156863;0.447058823529412;0.447058823529412;0.443137254901961;0.439215686274510;0.439215686274510;0.435294117647059;0.435294117647059;0.431372549019608;0.427450980392157;0.427450980392157;0.423529411764706;0.423529411764706;0.419607843137255;0.419607843137255;0.415686274509804;0.411764705882353;0.411764705882353;0.407843137254902;0.407843137254902;0.403921568627451;0.400000000000000;0.400000000000000;0.396078431372549;0.396078431372549;0.392156862745098;0.388235294117647;0.388235294117647;0.384313725490196;0.384313725490196;0.380392156862745;0.380392156862745;0.376470588235294;0.372549019607843;0.372549019607843;0.368627450980392;0.368627450980392;0.364705882352941;0.360784313725490;0.360784313725490;0.356862745098039;0.356862745098039;0.352941176470588;0.349019607843137;0.349019607843137;0.345098039215686;0.345098039215686;0.341176470588235;0.337254901960784;0.337254901960784;0.333333333333333;0.333333333333333;0.329411764705882;0.329411764705882;0.325490196078431;0.321568627450980;0.321568627450980;0.317647058823529;0.317647058823529;0.313725490196078;0.309803921568627;0.309803921568627;0.305882352941177;0.305882352941177;0.301960784313725;0.298039215686275;0.298039215686275;0.294117647058824;0.294117647058824;0.290196078431373;0.290196078431373;0.286274509803922;0.282352941176471;0.282352941176471;0.278431372549020;0.278431372549020;0.274509803921569;0.270588235294118;0.270588235294118;0.266666666666667;0.266666666666667;0.262745098039216;0.258823529411765;0.258823529411765;0.254901960784314;0.254901960784314;0.250980392156863;0.250980392156863;0.247058823529412;0.243137254901961;0.243137254901961;0.239215686274510;0.239215686274510;0.235294117647059;0.231372549019608;0.231372549019608;0.227450980392157;0.227450980392157;0.223529411764706;0.219607843137255;0.219607843137255;0.215686274509804;0.215686274509804;0.211764705882353;0.211764705882353;0.207843137254902;0.203921568627451;0.203921568627451;0.200000000000000;0.200000000000000;0.196078431372549;0.192156862745098;0.192156862745098;0.188235294117647;0.188235294117647;0.184313725490196;0.180392156862745;0.180392156862745;0.176470588235294;0.176470588235294;0.172549019607843;0.172549019607843;0.168627450980392;0.164705882352941;0.164705882352941;0.160784313725490;0.160784313725490;0.156862745098039;0.152941176470588;0.152941176470588;0.149019607843137;0.149019607843137;0.145098039215686;0.141176470588235;0.141176470588235;0.137254901960784;0.137254901960784;0.133333333333333;0.129411764705882;0.129411764705882;0.125490196078431;0.125490196078431;0.121568627450980;0.121568627450980;0.117647058823529;0.113725490196078;0.113725490196078;0.109803921568627;0.109803921568627;0.105882352941176;0.105882352941176;0.105882352941176;0.105882352941176;0.105882352941176;0.105882352941176;0.101960784313725;0.101960784313725;0.101960784313725;0.101960784313725;0.101960784313725;0.101960784313725;0.0980392156862745;0.0980392156862745;0.0980392156862745;0.0980392156862745;0.0980392156862745;0.0980392156862745;0.0941176470588235;0.0941176470588235;0.0941176470588235;0.0941176470588235;0.0941176470588235;0.0941176470588235;0.0901960784313726;0.0901960784313726;0.0901960784313726;0.0901960784313726;0.0901960784313726;0.0901960784313726;0.0862745098039216;0.0862745098039216;0.0862745098039216;0.0862745098039216;0.0862745098039216;0.0862745098039216;0.0862745098039216;0.0823529411764706;0.0823529411764706;0.0823529411764706;0.0823529411764706;0.0823529411764706;0.0823529411764706;0.0784313725490196;0.0784313725490196;0.0784313725490196;0.0784313725490196;0.0784313725490196;0.0784313725490196;0.0745098039215686;0.0745098039215686;0.0745098039215686;0.0745098039215686;0.0745098039215686;0.0745098039215686;0.0705882352941177;0.0705882352941177;0.0705882352941177;0.0705882352941177;0.0705882352941177;0.0705882352941177;0.0666666666666667;0.0666666666666667;0.0666666666666667;0.0666666666666667;0.0666666666666667;0.0666666666666667;0.0627450980392157;0.0627450980392157;0.0627450980392157;0.0627450980392157;0.0627450980392157;0.0627450980392157;0.0588235294117647;0.0588235294117647;0.0588235294117647;0.0588235294117647;0.0588235294117647;0.0588235294117647;0.0549019607843137;0.0549019607843137;0.0549019607843137;0.0549019607843137;0.0549019607843137;0.0549019607843137;0.0509803921568627;0.0509803921568627;0.0509803921568627;0.0509803921568627;0.0509803921568627;0.0509803921568627;0.0470588235294118;0.0470588235294118;0.0470588235294118;0.0470588235294118;0.0470588235294118;0.0470588235294118;0.0431372549019608;0.0431372549019608;0.0431372549019608;0.0431372549019608;0.0431372549019608;0.0431372549019608;0.0392156862745098;0.0392156862745098;0.0392156862745098;0.0392156862745098;0.0392156862745098;0.0392156862745098;0.0352941176470588;0.0352941176470588;0.0352941176470588;0.0352941176470588;0.0352941176470588;0.0352941176470588;0.0313725490196078;0.0313725490196078;0.0313725490196078;0.0313725490196078;0.0313725490196078;0.0313725490196078;0.0274509803921569;0.0274509803921569;0.0274509803921569;0.0274509803921569;0.0274509803921569;0.0274509803921569;0.0274509803921569;0.0235294117647059;0.0235294117647059;0.0235294117647059;0.0235294117647059;0.0235294117647059;0.0235294117647059;0.0196078431372549;0.0196078431372549;0.0196078431372549;0.0196078431372549;0.0196078431372549;0.0196078431372549;0.0156862745098039;0.0156862745098039;0.0156862745098039;0.0156862745098039;0.0156862745098039;0.0156862745098039;0.0117647058823529;0.0117647058823529;0.0117647058823529;0.0117647058823529;0.0117647058823529;0.0117647058823529;0.00784313725490196;0.00784313725490196;0.00784313725490196;0.00784313725490196;0.00784313725490196;0.00784313725490196;0.00392156862745098;0.00392156862745098;0.00392156862745098;0.00392156862745098;0.00392156862745098;0.00392156862745098;0;0;0;0;0;0;0];
b=[0.501960784313726;0.498039215686275;0.494117647058824;0.494117647058824;0.490196078431373;0.486274509803922;0.482352941176471;0.482352941176471;0.478431372549020;0.474509803921569;0.470588235294118;0.470588235294118;0.466666666666667;0.462745098039216;0.458823529411765;0.458823529411765;0.454901960784314;0.450980392156863;0.447058823529412;0.447058823529412;0.443137254901961;0.439215686274510;0.435294117647059;0.435294117647059;0.431372549019608;0.427450980392157;0.423529411764706;0.423529411764706;0.419607843137255;0.415686274509804;0.411764705882353;0.411764705882353;0.407843137254902;0.403921568627451;0.400000000000000;0.400000000000000;0.396078431372549;0.392156862745098;0.388235294117647;0.388235294117647;0.384313725490196;0.380392156862745;0.376470588235294;0.376470588235294;0.372549019607843;0.368627450980392;0.364705882352941;0.364705882352941;0.360784313725490;0.356862745098039;0.352941176470588;0.352941176470588;0.349019607843137;0.345098039215686;0.341176470588235;0.341176470588235;0.337254901960784;0.333333333333333;0.329411764705882;0.329411764705882;0.325490196078431;0.321568627450980;0.317647058823529;0.317647058823529;0.313725490196078;0.309803921568627;0.305882352941177;0.305882352941177;0.301960784313725;0.298039215686275;0.294117647058824;0.290196078431373;0.290196078431373;0.286274509803922;0.282352941176471;0.278431372549020;0.278431372549020;0.274509803921569;0.270588235294118;0.266666666666667;0.266666666666667;0.262745098039216;0.258823529411765;0.254901960784314;0.254901960784314;0.250980392156863;0.247058823529412;0.243137254901961;0.243137254901961;0.239215686274510;0.235294117647059;0.231372549019608;0.231372549019608;0.227450980392157;0.223529411764706;0.219607843137255;0.219607843137255;0.215686274509804;0.211764705882353;0.207843137254902;0.207843137254902;0.203921568627451;0.200000000000000;0.196078431372549;0.196078431372549;0.192156862745098;0.188235294117647;0.184313725490196;0.184313725490196;0.180392156862745;0.176470588235294;0.172549019607843;0.172549019607843;0.168627450980392;0.164705882352941;0.160784313725490;0.160784313725490;0.156862745098039;0.152941176470588;0.149019607843137;0.149019607843137;0.145098039215686;0.141176470588235;0.137254901960784;0.137254901960784;0.133333333333333;0.129411764705882;0.125490196078431;0.125490196078431;0.121568627450980;0.117647058823529;0.113725490196078;0.113725490196078;0.109803921568627;0.105882352941176;0.101960784313725;0.101960784313725;0.0980392156862745;0.0941176470588235;0.0901960784313726;0.0862745098039216;0.0862745098039216;0.0823529411764706;0.0784313725490196;0.0745098039215686;0.0745098039215686;0.0705882352941177;0.0666666666666667;0.0627450980392157;0.0627450980392157;0.0588235294117647;0.0549019607843137;0.0509803921568627;0.0509803921568627;0.0470588235294118;0.0431372549019608;0.0392156862745098;0.0392156862745098;0.0352941176470588;0.0313725490196078;0.0274509803921569;0.0274509803921569;0.0235294117647059;0.0196078431372549;0.0156862745098039;0.0156862745098039;0.0117647058823529;0.00784313725490196;0.00392156862745098;0.00392156862745098;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
set(newfig,'colormap',[r g b])

%setting of the titles of the figures
fig1_title=annotation(newfig,'textbox','Units','pixel','position',[posfig1(1) posfig1(2)+posfig1(4)+10 posfig1(3) 20 ],'linestyle','none','fontsize',fontsize,'color',Title_Color,'horizontalalignment','center');
fig2_title=annotation(newfig,'textbox','Units','pixel','position',[posfig2(1) posfig2(2)+posfig2(4)+10 posfig2(3) 20 ],'linestyle','none','fontsize',fontsize,'color',Title_Color,'horizontalalignment','center');
fig3_title=annotation(newfig,'textbox','Units','pixel','position',[posfig3(1) posfig3(2)+posfig3(4)+10 posfig3(3) 20 ],'linestyle','none','fontsize',fontsize,'color',Title_Color,'horizontalalignment','center');

%%
for i=3:N_file-2
    
    %Loading the data
    M1=load(fullfile(Dir,file_list(i).name));
    M2=load(fullfile(Dir,file_list(i+1).name));
    
    %doing the image difference 
   [diffM,~]=ABdiff2(M1,M2);
   
   %ploting
   
   axes(fig1)
   surf(M1);view(2);shading interp;
   axis tight
   set(fig1,'xticklabel',{''},'yticklabel',{''})
      
   axes(fig2)
   surf(M2);view(2);shading interp;
   axis tight
   set(fig2,'xticklabel',{''},'yticklabel',{''})
   
   axes(fig3)
   surf(diffM);view(2);shading interp;
   axis tight
   set(fig3,'xticklabel',{''},'yticklabel',{''})
   %writing the figure titles
   % Avia add:
   % Put atentian to the file_list location

   Fil1=num2str(Info.Field_Measured(i-2));
   Fil2=num2str(Info.Field_Measured(i-1));
   
   set(fig1_title,'String',strcat('Field [G]:  ',Fil1));
   set(fig2_title,'String',strcat('Field [G]:  ',Fil2));
   set(fig3_title,'String',strcat('Image difference: Field [G]: (',Fil1,') - (',Fil2,')'))
   set(newfig,'inverthardcopy','off')
   saveas(newfig,fullfile(Save_Loc,[file_list(i).name(end-7:end-4),'-',file_list(i+1).name(end-7:end-4) ]), 'jpg');   

   pause(0.01)
end





%%
% plot diff compare to the same image

Range=255:296;
% The location of files in the file_list structure
Save_Loc=fullfile(fileparts(Dir),'Diff_One');
if ~ exist(Save_Loc,'dir')
    mkdir(Save_Loc)
end

M1=load(fullfile(Dir,file_list(Range(1)).name));

for i=Range(2:end)
    
    %Loading the data
    M2=load(fullfile(Dir,file_list(i).name));
    
    %doing the image difference 
   [diffM,~]=ABdiff2(M1,M2);
   
   %ploting
   
   axes(fig1)
   surf(M1);view(2);shading interp;
   axis tight
   set(fig1,'xticklabel',{''},'yticklabel',{''})
      
   axes(fig2)
   surf(M2);view(2);shading interp;
   axis tight
   set(fig2,'xticklabel',{''},'yticklabel',{''})
   
   axes(fig3)
   surf(diffM);view(2);shading interp;
   axis tight
   set(fig3,'xticklabel',{''},'yticklabel',{''})
   %writing the figure titles
   % Avia add:
   % Put atentian to the file_list location

   Fil1=num2str(Info.Field_Measured(Range(1)-1));
   Fil2=num2str(Info.Field_Measured(i-1));
   
   set(fig1_title,'String',strcat('Field [G]:  ',Fil1));
   set(fig2_title,'String',strcat('Field [G]:  ',Fil2));
   set(fig3_title,'String',strcat('Image difference: Field [G]: (',Fil1,') - (',Fil2,')'))
   set(newfig,'inverthardcopy','off')
   saveas(newfig,fullfile(Save_Loc,[file_list(i).name(end-7:end-4),'-',file_list(i+1).name(end-7:end-4) ]), 'jpg');   

   pause(0.01)
end